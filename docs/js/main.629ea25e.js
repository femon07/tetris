"use strict";(self.webpackChunktetris=self.webpackChunktetris||[]).push([[792],{67:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(829),a=i(270),r=h(i(724)),o=h(i(235)),n=h(i(939));function h(t){return t&&t.__esModule?t:{default:t}}e.default=class{constructor({canvas:t,onUpdate:e=()=>{},onGameOver:i=()=>{}}){if(!t)throw new Error("Canvas element is required");this.canvas=t,this.ctx=t.getContext("2d"),this.onUpdate=e,this.onGameOver=i,this.state=new n.default,this.board=new r.default(s.COLS,s.ROWS),this.currentPiece=null,this.nextPiece=null,this.ghostPiece=null,this.isPressingDown=!1,this.dropStart=0,this.lastDropTime=0,this.lastMoveTime=0,this.moveDelay=100,this.autoRepeatDelay=100,this.lastMoveDirection=null,this.isAutoRepeating=!1,this.animationFrameId=null,this.setCanvasSize(),this.setupEventListeners(),this.init()}init(){this.board.reset(),this.state.reset(),this.spawnPiece(),this.update(),this.notifyUpdate()}setCanvasSize(){const t=Math.floor(this.canvas.offsetWidth/s.COLS);this.blockSize=t,this.canvas.width=s.COLS*t,this.canvas.height=s.ROWS*t,this.canvas.style.width=s.COLS*t+"px",this.canvas.style.height=s.ROWS*t+"px";const e=window.devicePixelRatio||1;this.canvas.width=s.COLS*t*e,this.canvas.height=s.ROWS*t*e,this.ctx.scale(e,e)}spawnPiece(){this.currentPiece=this.nextPiece||new o.default,this.nextPiece=new o.default,this.currentPiece.setPosition({x:Math.floor((s.COLS-this.currentPiece.width)/2),y:0}),this.updateGhostPiece(),this.checkCollision(this.currentPiece)&&this.gameOver()}updateGhostPiece(){if(this.currentPiece)for(this.ghostPiece=this.currentPiece.clone();!this.checkCollision(this.ghostPiece,{x:0,y:1});)this.ghostPiece.move({y:1})}checkCollision(t,e={x:0,y:0}){const i=t.clone();return i.move(e),!this.board.isValidPosition(i)}update(t=0){this.state.getState().state===s.GAME_STATE.PLAYING?((t-this.lastDropTime>this.getDropInterval()||this.isPressingDown)&&(this.moveDown(),this.lastDropTime=t),this.draw(),this.animationFrameId=requestAnimationFrame((t=>this.update(t)))):this.animationFrameId=requestAnimationFrame((t=>this.update(t)))}getDropInterval(){const t=this.state.getState().level,e=s.LEVEL_SPEED[Math.min(t,Object.keys(s.LEVEL_SPEED).length)];return this.isPressingDown?Math.max(50,e/10):e}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(),this.ghostPiece&&this.drawPiece(this.ghostPiece,.3),this.currentPiece&&this.drawPiece(this.currentPiece),this.drawGrid()}drawBoard(){const{grid:t}=this.board;for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i]&&this.drawBlock(i,e,t[e][i])}drawPiece(t,e=1){t.getBlocks().forEach((t=>{t.y>=0&&this.drawBlock(t.x,t.y,t.color,e)}))}drawBlock(t,e,i,s=1){const a=this.blockSize,r=a-2;this.ctx.fillStyle=i,this.ctx.globalAlpha=s,this.ctx.fillRect(t*a+1,e*a+1,r,r),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.fillRect(t*a+1,e*a+1,.7*r,.2*r),this.ctx.fillRect(t*a+1,e*a+1,.2*r,.7*r),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t*a+1+.3*r,e*a+1+.8*r,.7*r,.2*r),this.ctx.fillRect(t*a+1+.8*r,e*a+1+.3*r,.2*r,.7*r),this.ctx.globalAlpha=1}drawGrid(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=.5;for(let t=0;t<=s.COLS;t++)this.ctx.beginPath(),this.ctx.moveTo(t*this.blockSize,0),this.ctx.lineTo(t*this.blockSize,s.ROWS*this.blockSize),this.ctx.stroke();for(let t=0;t<=s.ROWS;t++)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.blockSize),this.ctx.lineTo(s.COLS*this.blockSize,t*this.blockSize),this.ctx.stroke()}moveLeft(){return!this.checkCollision(this.currentPiece,{x:-1,y:0})&&(this.currentPiece.move({x:-1}),this.updateGhostPiece(),this.lastMoveTime=performance.now(),this.lastMoveDirection="left",this.notifyUpdate(),!0)}moveRight(){return!this.checkCollision(this.currentPiece,{x:1,y:0})&&(this.currentPiece.move({x:1}),this.updateGhostPiece(),this.lastMoveTime=performance.now(),this.lastMoveDirection="right",this.notifyUpdate(),!0)}moveDown(){return this.checkCollision(this.currentPiece,{x:0,y:1})?(this.lockPiece(),!1):(this.currentPiece.move({y:1}),this.updateGhostPiece(),this.notifyUpdate(),!0)}rotate(){const t=this.currentPiece.rotation;if(this.currentPiece.rotate(),this.checkCollision(this.currentPiece)){const e=[1,-1,2,-2];for(const t of e)if(!this.checkCollision(this.currentPiece,{x:t,y:0}))return this.currentPiece.move({x:t}),this.updateGhostPiece(),this.notifyUpdate(),!0;for(;this.currentPiece.rotation!==t;)this.currentPiece.rotateCounterClockwise();return!1}return this.updateGhostPiece(),this.notifyUpdate(),!0}hardDrop(){let t=0;for(;!this.checkCollision(this.currentPiece,{x:0,y:t+1});)t++;return t>0&&(this.currentPiece.move({y:t}),this.lockPiece(),!0)}lockPiece(){const t=this.board.lock(this.currentPiece);t>0&&(this.state.addScore(t),(0,a.calculateLevel)(this.state.getState().lines,s.LINES_PER_LEVEL),this.state.getState().level),this.spawnPiece(),this.notifyUpdate()}start(){return!!this.state.start()&&(this.lastDropTime=performance.now(),this.update(),this.notifyUpdate(),!0)}pause(){return this.state.pause()}gameOver(){return!!this.state.gameOver()&&(this.onGameOver(this.state.getState()),this.notifyUpdate(),!0)}reset(){cancelAnimationFrame(this.animationFrameId),this.board.reset(),this.state.reset(),this.spawnPiece(),this.lastDropTime=performance.now(),this.update(),this.notifyUpdate()}notifyUpdate(){"function"==typeof this.onUpdate&&this.onUpdate({...this.state.getState(),nextPiece:this.nextPiece,board:this.board.getState()})}setupEventListeners(){document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),(0,a.isMobileDevice)()&&this.setupTouchControls(),window.addEventListener("resize",this.handleResize.bind(this))}handleKeyDown(t){if(this.state.getState().state===s.GAME_STATE.PLAYING){switch(t.key){case s.KEY.LEFT:this.isAutoRepeating||(this.moveLeft(),this.isAutoRepeating=!0,this.autoRepeatTimeout=setTimeout((()=>{this.autoRepeatInterval=setInterval((()=>this.moveLeft()),this.autoRepeatDelay)}),this.moveDelay));break;case s.KEY.RIGHT:this.isAutoRepeating||(this.moveRight(),this.isAutoRepeating=!0,this.autoRepeatTimeout=setTimeout((()=>{this.autoRepeatInterval=setInterval((()=>this.moveRight()),this.autoRepeatDelay)}),this.moveDelay));break;case s.KEY.DOWN:this.isPressingDown=!0;break;case s.KEY.UP:this.rotate();break;case" ":this.hardDrop();break;case"p":case"P":this.pause();break;case"r":case"R":this.reset()}[s.KEY.LEFT,s.KEY.RIGHT,s.KEY.DOWN,s.KEY.UP," ","p","P","r","R"].includes(t.key)&&t.preventDefault()}}handleKeyUp(t){switch(t.key){case s.KEY.LEFT:case s.KEY.RIGHT:clearTimeout(this.autoRepeatTimeout),clearInterval(this.autoRepeatInterval),this.isAutoRepeating=!1;break;case s.KEY.DOWN:this.isPressingDown=!1}}setupTouchControls(){let t=0,e=0,i=0;this.canvas.addEventListener("touchstart",(a=>{if(this.state.getState().state!==s.GAME_STATE.PLAYING)return;const r=a.touches[0];t=r.clientX,e=r.clientY,i=Date.now(),this.longPressTimer=setTimeout((()=>{this.isPressingDown=!0}),300),a.preventDefault()}),{passive:!1}),this.canvas.addEventListener("touchmove",(t=>{t.preventDefault()}),{passive:!1}),this.canvas.addEventListener("touchend",(a=>{if(this.state.getState().state!==s.GAME_STATE.PLAYING)return;clearTimeout(this.longPressTimer),this.isPressingDown=!1;const r=a.changedTouches[0],o=r.clientX-t,n=r.clientY-e;Date.now()-i<300&&(Math.abs(o)>Math.abs(n)?o>30?this.moveRight():o<-30&&this.moveLeft():n>30?this.hardDrop():this.rotate()),a.preventDefault()}),{passive:!1})}handleResize(){this.setCanvasSize(),this.draw()}destroy(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),cancelAnimationFrame(this.animationFrameId),clearTimeout(this.autoRepeatTimeout),clearInterval(this.autoRepeatInterval),clearTimeout(this.longPressTimer),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}},228:(t,e,i)=>{i.r(e)},235:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(829),a=i(270);class r{constructor(t=null,e={x:0,y:0}){this.type=null!==t?t:Math.floor(Math.random()*s.TETROMINOS.length),this.matrix=(0,a.deepCopyMatrix)(s.TETROMINOS[this.type]),this.position={...e},this.color=s.COLORS[this.type+1],this.rotation=0}rotate(){return this.matrix=(0,a.rotateMatrix)(this.matrix),this.rotation=(this.rotation+1)%4,this.matrix}rotateCounterClockwise(){for(let t=0;t<3;t++)this.matrix=(0,a.rotateMatrix)(this.matrix);return this.rotation=(this.rotation+3)%4,this.matrix}move(t){this.position.x+=t.x||0,this.position.y+=t.y||0}setPosition(t){void 0!==t.x&&(this.position.x=t.x),void 0!==t.y&&(this.position.y=t.y)}getBlocks(){const t=[];for(let e=0;e<this.matrix.length;e++)for(let i=0;i<this.matrix[e].length;i++)this.matrix[e][i]&&t.push({x:this.position.x+i,y:this.position.y+e,color:this.color});return t}clone(){const t=new r(this.type,{...this.position});return t.matrix=(0,a.deepCopyMatrix)(this.matrix),t.rotation=this.rotation,t}get width(){return this.matrix[0].length}get height(){return this.matrix.length}get left(){return this.position.x}get right(){return this.position.x+this.width}get top(){return this.position.y}get bottom(){return this.position.y+this.height}static createRandom(t={x:0,y:0}){const e=Math.floor(Math.random()*s.TETROMINOS.length);return new r(e,t)}}e.default=r},270:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.transposeMatrix=e.sleep=e.rotateMatrix=e.isMobileDevice=e.getTouchPosition=e.getRandomInt=e.deepCopyMatrix=e.calculateScore=e.calculateLevel=e.calculateGameSpeed=e.arePositionsEqual=void 0,e.deepCopyMatrix=t=>t.map((t=>[...t])),e.transposeMatrix=t=>t[0].map(((e,i)=>t.map((t=>t[i])))),e.rotateMatrix=t=>{const e=t.length,i=Array(e).fill().map((()=>Array(e).fill(0)));for(let s=0;s<e;s++)for(let a=0;a<e;a++)i[a][e-1-s]=t[s][a];return i},e.arePositionsEqual=(t,e)=>t.x===e.x&&t.y===e.y,e.getRandomInt=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,e.sleep=t=>new Promise((e=>setTimeout(e,t))),e.calculateScore=(t,e=0)=>{if(0===t)return e;const i=Math.floor(e/1e3)+1;return e+([0,40,100,300,1200][t]||0)*i},e.calculateLevel=(t,e=10)=>Math.floor(t/e)+1,e.calculateGameSpeed=(t,e)=>e[Math.min(t,Object.keys(e).length)]||e[Object.keys(e).length],e.isMobileDevice=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e.getTouchPosition=t=>{if(!t.touches)return null;const e=t.touches[0]||t.changedTouches[0],i=t.target.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}},724:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(829),a=i(270);class r{constructor(t=s.COLS,e=s.ROWS){this.cols=t,this.rows=e,this.grid=this.createEmptyGrid(),this.clearedLines=0}createEmptyGrid(){return Array(this.rows).fill().map((()=>Array(this.cols).fill(0)))}reset(){this.grid=this.createEmptyGrid(),this.clearedLines=0}isValidPosition(t){const e=t.matrix,i=t.position;for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)if(0!==e[t][s]){const e=i.x+s,a=i.y+t;if(e<0||e>=this.cols||a<0||a>=this.rows)return!1;if(a>=0&&0!==this.grid[a][e])return!1}return!0}lock(t){return t.getBlocks().forEach((t=>{t.y>=0&&(this.grid[t.y][t.x]=t.color)})),this.clearLines()}clearLines(){let t=0;for(let e=this.rows-1;e>=0;e--)this.isLineComplete(e)&&(this.removeLine(e),t++,e++);return this.clearedLines+=t,t}isLineComplete(t){for(let e=0;e<this.cols;e++)if(0===this.grid[t][e])return!1;return!0}removeLine(t){this.grid.splice(t,1),this.grid.unshift(Array(this.cols).fill(0))}clone(){const t=new r(this.cols,this.rows);return t.grid=(0,a.deepCopyMatrix)(this.grid),t.clearedLines=this.clearedLines,t}getState(){return{grid:(0,a.deepCopyMatrix)(this.grid),clearedLines:this.clearedLines,width:this.cols,height:this.rows}}clear(){this.grid=this.createEmptyGrid(),this.clearedLines=0}print(){console.log("--- BOARD ---");for(let t=0;t<this.rows;t++){let e="";for(let i=0;i<this.cols;i++)e+=this.grid[t][i]?"■":"·";console.log(e)}console.log("-------------")}}e.default=r},829:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TETROMINOS=e.SCORE_TABLE=e.ROWS=e.LINES_PER_LEVEL=e.LEVEL_SPEED=e.KEY=e.GAME_STATE=e.COLS=e.COLORS=e.BLOCK_SIZE=void 0,e.COLS=10,e.ROWS=20,e.BLOCK_SIZE=30,e.COLORS=["#000000","#00FFFF","#FF00FF","#00FF00","#FFFF00","#FF0000","#0000FF","#FFA500"],e.TETROMINOS=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[4,4],[4,4]],[[0,2,0],[2,2,2],[0,0,0]],[[0,3,3],[3,3,0],[0,0,0]],[[5,5,0],[0,5,5],[0,0,0]],[[6,0,0],[6,6,6],[0,0,0]],[[0,0,7],[7,7,7],[0,0,0]]],e.LEVEL_SPEED={1:1e3,2:900,3:800,4:700,5:600,6:500,7:400,8:300,9:200,10:100,11:80,12:60,13:40,14:30,15:20,16:10,17:5,18:4,19:3,20:2,21:1},e.LINES_PER_LEVEL=10,e.SCORE_TABLE={1:100,2:300,3:500,4:800},e.KEY={LEFT:"ArrowLeft",RIGHT:"ArrowRight",DOWN:"ArrowDown",UP:"ArrowUp",SPACE:" ",P:"p",R:"r"},e.GAME_STATE={READY:"ready",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"gameOver"}},877:(t,e,i)=>{var s,a=(s=i(67))&&s.__esModule?s:{default:s},r=i(270);i(228);let o=null;const n=document.getElementById("game"),h=document.getElementById("start-button"),l=document.getElementById("pause-button"),c=document.getElementById("restart-button"),d=document.getElementById("score"),u=document.getElementById("level"),p=document.getElementById("lines"),m=document.getElementById("high-score"),g=document.getElementById("next-piece"),E=(g?.getContext("2d"),document.getElementById("game-over"));function v(t){if(!t)return;d&&(d.textContent=t.score||0),u&&(u.textContent=t.level||1),p&&(p.textContent=t.lines||0);const e=Math.max(t.score||0,parseInt(localStorage.getItem("tetrisHighScore")||"0"));localStorage.setItem("tetrisHighScore",e.toString()),m&&(m.textContent=e)}function f(){console.log("Game Over"),E&&(E.style.display="flex"),c&&(c.disabled=!1)}function S(){o&&o.destroy(),E&&(E.style.display="none"),o=new a.default({canvas:n,onUpdate:v,onGameOver:f});const t=localStorage.getItem("tetrisHighScore")||"0";m&&(m.textContent=t),v({score:0,level:1,lines:0,state:"playing"}),o.start()}function y(){if(!n)return;const t=n.parentElement;if(!t)return;let e=t.clientWidth-40,i=e/.5;i>window.innerHeight-100&&(i=window.innerHeight-100,e=.5*i),n.style.width=`${e}px`,n.style.height=`${i}px`,o&&o.render()}h&&h.addEventListener("click",(()=>{o&&"gameOver"!==o.state.getState().state?"paused"===o.state.getState().state?(o.resume(),l.textContent="Pause"):(o.pause(),l.textContent="Resume"):S()})),l&&l.addEventListener("click",(()=>{if(!o)return;const t=o.state.getState();"playing"===t.state?(o.pause(),l.textContent="Resume"):"paused"===t.state&&(o.resume(),l.textContent="Pause")})),c&&c.addEventListener("click",(()=>{o&&S()})),document.addEventListener("keydown",(t=>{if(!o)return;const e=o.state.getState();switch(t.key){case"Escape":"playing"===e.state?(o.pause(),l&&(l.textContent="Resume")):"paused"===e.state&&(o.resume(),l&&(l.textContent="Pause"));break;case"r":case"R":"gameOver"===e.state&&S();break;case" ":"playing"===e.state&&o.hardDrop()}})),document.addEventListener("touchmove",(t=>{(0,r.isMobileDevice)()&&t.target===document.body&&t.preventDefault()}),{passive:!1}),window.addEventListener("load",(()=>{const t=localStorage.getItem("tetrisHighScore")||"0";m&&(m.textContent=t),y(),S()})),window.addEventListener("resize",(()=>{y()}))},939:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(829);e.default=class{constructor(){this.state=s.GAME_STATE.READY,this.score=0,this.lines=0,this.level=1,this.highScore=parseInt(localStorage.getItem("tetrisHighScore")||"0",10),this.startTime=null,this.elapsedTime=0,this.lastUpdateTime=null}start(){return(this.state===s.GAME_STATE.READY||this.state===s.GAME_STATE.GAME_OVER)&&(this.state=s.GAME_STATE.PLAYING,this.score=0,this.lines=0,this.level=1,this.startTime=Date.now(),this.lastUpdateTime=this.startTime,this.elapsedTime=0,!0)}pause(){return this.state===s.GAME_STATE.PLAYING?(this.state=s.GAME_STATE.PAUSED,this.updateElapsedTime(),!0):this.state===s.GAME_STATE.PAUSED&&(this.state=s.GAME_STATE.PLAYING,this.lastUpdateTime=Date.now(),!0)}gameOver(){return this.state===s.GAME_STATE.PLAYING&&(this.state=s.GAME_STATE.GAME_OVER,this.updateElapsedTime(),this.updateHighScore(),!0)}updateElapsedTime(){if(this.state===s.GAME_STATE.PLAYING&&this.lastUpdateTime){const t=Date.now();this.elapsedTime+=t-this.lastUpdateTime,this.lastUpdateTime=t}}updateHighScore(){this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("tetrisHighScore",this.highScore.toString()))}addScore(t){if(t<1||t>4)return 0;const e=[0,100,300,500,800][t]*this.level;this.score+=e;const i=this.lines+t,s=Math.floor(i/10)+1,a=s>this.level;return this.lines=i,a&&(this.level=s),e}reset(){this.state=s.GAME_STATE.READY,this.score=0,this.lines=0,this.level=1,this.startTime=null,this.elapsedTime=0,this.lastUpdateTime=null}getState(){return{state:this.state,score:this.score,lines:this.lines,level:this.level,highScore:this.highScore,elapsedTime:this.getElapsedTime()}}getElapsedTime(){const t=Math.floor((this.elapsedTime+(this.state===s.GAME_STATE.PLAYING?Date.now()-this.lastUpdateTime:0))/1e3),e=t%60;return`${Math.floor(t/60).toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}}}},t=>{t(t.s=877)}]);
//# sourceMappingURL=main.629ea25e.js.map