# 🚀 宇宙テーマリッチUI実装計画

## 📋 概要
既存のWebGL 3Dレンダリング基盤を活用して、宇宙をテーマにした没入感のあるUIを実装。消した行数に応じて宇宙戦闘が激化し、視覚的な報酬とスリルを提供する。

**開始日**: 2025-06-19  
**ブランチ**: `feature/space-theme-ui`  
**想定期間**: 3週間

---

## 🎯 実装する機能

### 1. 宇宙背景システム ⭐⭐⭐⭐⭐ ✅ **完了**
- **星空背景**: 無限に流れる星フィールド (2000個の星)
- **宇宙船**: プレイヤーの宇宙船（ゲームボード下部）
- **敵母艦**: 画面上部の巨大な敵艦
- **動的背景**: レベルに応じて色調変化（青→紫→赤→炎）
- **実装ファイル**: `src/themes/space/SpaceBackground.js`

### 2. ライン消去→宇宙戦闘システム ⭐⭐⭐⭐⭐ 🔄 **進行中**
- **ミサイル発射**: ライン消去時に宇宙船からミサイル発射
- **敵機出現**: 高コンボ時に敵戦闘機が飛来
- **爆発エフェクト**: ミサイル命中時の派手な爆発
- **戦闘激化**: 連続消去で戦闘が激しくなる
- **実装ファイル**: 
  - `src/themes/space/SpaceMissiles.js` 🔄
  - `src/themes/space/EnemyFleet.js` 📋
  - `src/themes/space/SpaceExplosions.js` 📋

### 3. 段階的エフェクト強化 ⭐⭐⭐⭐ 📋 **計画段階**
- **シングル**: 小さなレーザー
- **ダブル**: ミサイル1発
- **トリプル**: ミサイル2発 + 敵機1機
- **テトリス**: 大爆発 + 敵機複数 + 画面シェイク

### 4. 宇宙ステーション進化システム ⭐⭐⭐⭐ 📋 **計画段階**
- **レベルアップ**: 宇宙ステーションが進化
- **武器強化**: より強力な武器にアップグレード
- **シールド**: 高レベルでシールドエフェクト
- **ワープエフェクト**: レベル変化時のワープ演出
- **実装ファイル**: `src/themes/space/SpaceStations.js` 📋

---

## 🔧 技術実装詳細

### 完了済みファイル構成 ✅
```
src/themes/space/
├── SpaceBackground.js      ✅ 星空・宇宙背景
├── SpaceShip.js           ✅ プレイヤー宇宙船
├── SpaceThemeManager.js   ✅ 全体統括管理
└── [ファイルは作成済み]

src/rendering/webgl/
└── WebGLSpaceRenderer.js  ✅ 宇宙専用レンダラー
```

### 実装予定ファイル構成 🔄📋
```
src/themes/space/
├── SpaceMissiles.js       🔄 ミサイルシステム
├── EnemyFleet.js          📋 敵艦隊管理
├── SpaceExplosions.js     📋 爆発エフェクト
└── SpaceStations.js       📋 宇宙ステーション

src/rendering/webgl/
├── WebGLSpaceEffects.js   📋 宇宙エフェクト統合
└── WebGLSpaceShaders.js   📋 宇宙用シェーダー
```

### 統合作業 📋
```
既存ファイル修正:
├── src/core/Game.js              📋 ライン消去→戦闘連動
├── src/rendering/WebGLRenderer.js 📋 宇宙テーマ統合
└── 設定システム                   📋 テーマ切り替え機能
```

---

## 🎨 視覚仕様

### 色調設計 ✅ **実装済み**
- **レベル1-3**: 深い青色の宇宙 (0x000011 → 0x4488ff)
- **レベル4-6**: 紫がかった星雲 (0x110022 → 0x8844ff)
- **レベル7-9**: 赤い戦闘宙域 (0x220011 → 0xff4444)
- **レベル10+**: 炎の宇宙戦争 (0x331100 → 0xff8844)

### エフェクト仕様
- **ミサイル軌道**: 光の尾を引く弾道 🔄
- **爆発**: 放射状パーティクル + 光の波 📋
- **敵機**: 小型戦闘機、回避行動付き 📋
- **背景**: 流れる星、宇宙塵、星雲 ✅

### 宇宙船仕様 ✅ **実装済み**
- **メインハル**: コーン型本体 + ウィング
- **エンジン**: 左右2基、シェーダー炎エフェクト
- **武器システム**: レベル1-10の段階的強化
  - Lv1: 基本レーザー
  - Lv3: ミサイルポッド
  - Lv5: プラズマ砲
  - Lv7: シールド発生器
  - Lv9: 超兵器
- **シールド**: フレネル効果によるバリア

---

## 📊 実装進捗状況

### Week 1: 基盤構築 ✅ **完了**
1. **Day 1-2**: 宇宙背景システム ✅
   - 星空・流れる星フィールド ✅
   - レベル別色調変化 ✅
   - 星雲背景 ✅
2. **Day 3-4**: 宇宙船 + 統括管理 ✅
   - プレイヤー宇宙船 ✅
   - 武器システム ✅
   - テーマ統括管理 ✅
3. **Day 5**: 宇宙専用レンダラー ✅
   - WebGL統合 ✅
   - カメラシェイク ✅

### Week 2: 戦闘システム 🔄 **進行中**
1. **Day 1-2**: ミサイルシステム 🔄
   - ミサイル基本機能 🔄
   - 軌道・着弾エフェクト 📋
2. **Day 3-4**: 敵機・爆発エフェクト 📋
   - 敵艦隊管理 📋
   - 爆発パーティクル 📋
3. **Day 5**: 段階的エフェクト強化 📋
   - シングル→テトリス演出 📋

### Week 3: 統合・ポリッシュ 📋 **計画段階**
1. **Day 1-2**: ゲーム統合 📋
   - Game.js連動 📋
   - WebGLRenderer統合 📋
2. **Day 3-4**: 最終調整 📋
   - パフォーマンス最適化 📋
   - テーマ切り替え機能 📋
3. **Day 5**: テスト・デバッグ 📋

---

## 🎯 ユーザー体験設計

### 没入感の演出
- **宇宙戦争の主人公**: プレイヤーは宇宙船の艦長
- **リアルタイム戦闘**: ライン消去 = 敵撃墜の爽快感
- **視覚的報酬**: 派手なエフェクトによる達成感
- **進歩の実感**: レベルアップで宇宙船が強化

### 戦闘システムの流れ
1. **ライン消去発生** → ミサイル発射
2. **連続消去** → 敵機出現、戦闘激化
3. **テトリス達成** → 大爆発、画面シェイク
4. **レベルアップ** → 宇宙船強化、ワープ演出

### 段階的エスカレーション
- **初期**: 静かな宇宙
- **中盤**: 小規模戦闘
- **高レベル**: 激しい宇宙戦争
- **最高レベル**: 炎に包まれた決戦

---

## 🚧 技術的課題と対策

### パフォーマンス最適化
- **パーティクル制限**: 最大数制限とLOD
- **シェーダー最適化**: 複雑な計算の簡素化
- **オブジェクトプール**: ミサイル・爆発の再利用

### UX配慮
- **視覚的混乱防止**: エフェクトの適切な透明度
- **操作阻害回避**: 重要UIの視認性確保
- **設定による制御**: エフェクト強度の調整可能

### ブラウザ互換性
- **WebGL対応**: モダンブラウザでの最適化
- **フォールバック**: 低性能環境での機能制限
- **メモリ管理**: 長時間プレイでのメモリリーク防止

---

## 📋 現在のタスクリスト

### 🔄 進行中 (High Priority)
1. **SpaceMissiles.js** - ミサイルシステム基本実装

### 📋 次期実装 (High Priority)
2. **EnemyFleet.js** - 敵艦隊管理システム
3. **SpaceExplosions.js** - 爆発エフェクト
4. **Game.js統合** - ライン消去→宇宙戦闘連動
5. **WebGLRenderer.js統合** - 宇宙テーマ統合

### 📋 後期実装 (Medium Priority)
6. **SpaceStations.js** - 宇宙ステーション進化
7. **WebGLSpaceEffects.js** - 宇宙エフェクト統合
8. **WebGLSpaceShaders.js** - 宇宙用シェーダー
9. **レベル進行色調変化** - システム統合
10. **段階的エフェクト強化** - シングル→テトリス

### 📋 最終工程 (Low Priority)
11. **パフォーマンス最適化** - 60fps維持
12. **設定でテーマ切り替え** - UI統合

---

## 🎯 成功指標

### 技術指標 
- **パフォーマンス**: 60fps安定維持 ✅
- **メモリ使用量**: 増加を50MB以下に抑制
- **初期化時間**: 3秒以下でテーマ読み込み
- **エラー率**: WebGL非対応環境での安全なフォールバック

### ユーザー体験指標
- **没入感**: 宇宙戦争の臨場感
- **達成感**: ライン消去 = 敵撃墜の爽快感
- **進歩感**: レベルアップでの視覚的強化実感
- **操作性**: エフェクトによる操作阻害なし

### 視覚品質指標
- **エフェクト品質**: 派手で美しい宇宙戦闘演出
- **一貫性**: 宇宙テーマの統一感
- **レスポンシブ**: 即座の視覚フィードバック
- **カスタマイズ性**: エフェクト強度の調整可能

---

## 📚 関連ドキュメント

- **技術仕様**: `/docs/FEATURES.md` - 全機能の詳細仕様
- **基本計画**: `/planning/active/GAMEPLAY_ENHANCEMENT_PLAN.md` - 元の機能拡張計画
- **開発ガイド**: `/CLAUDE.md` - プロジェクト開発指針
- **アーキテクチャ**: 既存WebGL基盤のドキュメント

---

**作成日**: 2025-06-19  
**最終更新**: 2025-06-19  
**ステータス**: 🔄 **積極的実装中**  
**完了率**: **29% (5/17項目完了)**

🚀 **次のマイルストーン**: ミサイルシステム完成 → 敵艦隊実装 → 爆発エフェクト